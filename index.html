<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üí∞ Î∂ÄÎ∂Ä Í≥µÏú† Í∞ÄÍ≥ÑÎ∂Ä</title>
    
    <!-- Firebase SDK (Firestore) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            overflow-x: hidden;
            width: 100vw;
        }
        
        #root {
            width: 100%;
            min-height: 100vh;
        }
        
        /* Ïà´Ïûê ÏûÖÎ†• ÌïÑÎìú ÏµúÏ†ÅÌôî */
        input[type="number"] {
            -moz-appearance: textfield;
        }
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        /* ÎÇ†Ïßú ÏûÖÎ†• ÌïÑÎìú ÏµúÏ†ÅÌôî */
        input[type="date"] {
            min-width: 110px;
        }
        
        /* Ïä§ÌÅ¨Î°§Î∞î Ïà®Í∏∞Í∏∞ */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyBiC54tZWk4qK3dRjlgEhTmWhLkLTF7JJU",
            authDomain: "dasol-moneybook-28576.firebaseapp.com",
            projectId: "dasol-moneybook-28576",
            storageBucket: "dasol-moneybook-28576.firebasestorage.app",
            messagingSenderId: "197049671466",
            appId: "1:197049671466:web:c382db717dfa195cdac853"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // ÏïÑÏù¥ÏΩò Ïª¥Ìè¨ÎÑåÌä∏Îì§
        const ChevronDown = ({ size = 24 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            }, React.createElement('polyline', { points: "6 9 12 15 18 9" }))
        );

        const ChevronUp = ({ size = 24 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            }, React.createElement('polyline', { points: "18 15 12 9 6 15" }))
        );

        const Plus = ({ size = 24 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('line', { x1: "12", y1: "5", x2: "12", y2: "19" }),
                React.createElement('line', { x1: "5", y1: "12", x2: "19", y2: "12" })
            )
        );

        const Trash2 = ({ size = 20 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('polyline', { points: "3 6 5 6 21 6" }),
                React.createElement('path', { d: "M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" }),
                React.createElement('line', { x1: "10", y1: "11", x2: "10", y2: "17" }),
                React.createElement('line', { x1: "14", y1: "11", x2: "14", y2: "17" })
            )
        );

        const Edit2 = ({ size = 16 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('path', { d: "M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" }),
                React.createElement('path', { d: "M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" })
            )
        );

        const X = ({ size = 16 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('line', { x1: "18", y1: "6", x2: "6", y2: "18" }),
                React.createElement('line', { x1: "6", y1: "6", x2: "18", y2: "18" })
            )
        );

        // ÌïúÍ∏Ä ÏûÖÎ†•ÏùÑ ÏúÑÌïú debounce Ìï®Ïàò
        function useDebounce(value, delay) {
            const [debouncedValue, setDebouncedValue] = useState(value);

            useEffect(() => {
                const handler = setTimeout(() => {
                    setDebouncedValue(value);
                }, delay);

                return () => {
                    clearTimeout(handler);
                };
            }, [value, delay]);

            return debouncedValue;
        }

        // ÌïúÍ∏Ä ÏûÖÎ†• Í∞ÄÎä•Ìïú Input Ïª¥Ìè¨ÎÑåÌä∏
        function KoreanInput({ value, onChange, disabled, ...props }) {
            const [localValue, setLocalValue] = useState(value);
            const debouncedValue = useDebounce(localValue, 300);
            const isComposingRef = useRef(false);

            useEffect(() => {
                setLocalValue(value);
            }, [value]);

            useEffect(() => {
                if (!isComposingRef.current && debouncedValue !== value) {
                    onChange(debouncedValue);
                }
            }, [debouncedValue]);

            const handleChange = (e) => {
                setLocalValue(e.target.value);
            };

            const handleCompositionStart = () => {
                isComposingRef.current = true;
            };

            const handleCompositionEnd = (e) => {
                isComposingRef.current = false;
                setLocalValue(e.target.value);
                onChange(e.target.value);
            };

            const handleBlur = (e) => {
                onChange(e.target.value);
            };

            return (
                <input
                    {...props}
                    value={localValue}
                    onChange={handleChange}
                    onCompositionStart={handleCompositionStart}
                    onCompositionEnd={handleCompositionEnd}
                    onBlur={handleBlur}
                    disabled={disabled}
                />
            );
        }

        function Household() {
            const [activeMonth, setActiveMonth] = useState('25ÎÖÑ11Ïõî');
            const [monthData, setMonthData] = useState({});
            const [isFixedExpanded, setIsFixedExpanded] = useState(true);
            const [isExpenseExpanded, setIsExpenseExpanded] = useState(true);
            const [isIncomeExpanded, setIsIncomeExpanded] = useState(true);
            const [months, setMonths] = useState([]);
            const [showAddMonth, setShowAddMonth] = useState(false);
            const [newMonthYear, setNewMonthYear] = useState('25');
            const [newMonthMonth, setNewMonthMonth] = useState('01');
            const [editingItems, setEditingItems] = useState({});
            const [isLoading, setIsLoading] = useState(true);
            const [editingMonth, setEditingMonth] = useState(null);
            const [editMonthValue, setEditMonthValue] = useState('');

            useEffect(() => {
                const unsubscribe = db.collection('household').onSnapshot((snapshot) => {
                    const data = {};
                    const monthsList = [];
                    
                    snapshot.forEach((doc) => {
                        const monthName = doc.id;
                        monthsList.push(monthName);
                        data[monthName] = doc.data();
                    });

                    if (monthsList.length === 0) {
                        const initialMonths = ['25ÎÖÑ11Ïõî', '25ÎÖÑ12Ïõî', '26ÎÖÑ01Ïõî'];
                        const initialData = {
                            fixed: [],
                            expense: [],
                            income: []
                        };

                        initialMonths.forEach(month => {
                            db.collection('household').doc(month).set(initialData);
                        });
                    } else {
                        monthsList.sort((a, b) => {
                            const [aYear, aMonth] = a.replace('ÎÖÑ', '-').replace('Ïõî', '').split('-');
                            const [bYear, bMonth] = b.replace('ÎÖÑ', '-').replace('Ïõî', '').split('-');
                            return parseInt(aYear + aMonth) - parseInt(bYear + bMonth);
                        });

                        setMonths(monthsList);
                        setMonthData(data);
                        setIsLoading(false);
                    }
                });

                return () => unsubscribe();
            }, []);

            const currentData = monthData[activeMonth] || { fixed: [], expense: [], income: [] };

            const formatNumber = (num) => {
                if (!num) return '0';
                return parseInt(num).toLocaleString('ko-KR');
            };

            const calculateTotal = (items) => {
                return items.reduce((sum, item) => sum + (parseInt(item.amount) || 0), 0);
            };

            const addMonth = () => {
                const newMonth = `${newMonthYear}ÎÖÑ${newMonthMonth}Ïõî`;
                if (!months.includes(newMonth)) {
                    db.collection('household').doc(newMonth).set({
                        fixed: [],
                        expense: [],
                        income: []
                    });
                    setShowAddMonth(false);
                }
            };

            const deleteMonth = (month) => {
                if (months.length <= 1) {
                    alert('ÎßàÏßÄÎßâ ÏõîÏùÄ ÏÇ≠Ï†úÌï† Ïàò ÏóÜÏäµÎãàÎã§.');
                    return;
                }
                if (window.confirm(`${month}ÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                    db.collection('household').doc(month).delete();
                    if (activeMonth === month) {
                        const index = months.indexOf(month);
                        const newActiveMonth = months[index === 0 ? 1 : index - 1];
                        setActiveMonth(newActiveMonth);
                    }
                }
            };

            const startEditMonth = (month) => {
                setEditingMonth(month);
                setEditMonthValue(month);
            };

            const saveEditMonth = () => {
                if (editMonthValue && editMonthValue !== editingMonth && !months.includes(editMonthValue)) {
                    const oldData = monthData[editingMonth];
                    db.collection('household').doc(editMonthValue).set(oldData);
                    db.collection('household').doc(editingMonth).delete();
                    if (activeMonth === editingMonth) {
                        setActiveMonth(editMonthValue);
                    }
                    setEditingMonth(null);
                } else {
                    setEditingMonth(null);
                }
            };

            const addFixed = () => {
                const today = new Date().toISOString().split('T')[0];
                const newFixed = {
                    id: Date.now(),
                    date: today,
                    content: '',
                    amount: ''
                };
                const updated = [...currentData.fixed, newFixed];
                db.collection('household').doc(activeMonth).update({ fixed: updated });
                setEditingItems({ ...editingItems, [`fixed-${newFixed.id}`]: true });
            };

            const updateFixed = (id, field, value) => {
                const updated = currentData.fixed.map(item =>
                    item.id === id ? { ...item, [field]: value } : item
                );
                db.collection('household').doc(activeMonth).update({ fixed: updated });
            };

            const deleteFixed = (id) => {
                const updated = currentData.fixed.filter(item => item.id !== id);
                db.collection('household').doc(activeMonth).update({ fixed: updated });
            };

            const addExpense = () => {
                const today = new Date().toISOString().split('T')[0];
                const newExpense = {
                    id: Date.now(),
                    date: today,
                    content: '',
                    amount: ''
                };
                const updated = [...currentData.expense, newExpense];
                db.collection('household').doc(activeMonth).update({ expense: updated });
                setEditingItems({ ...editingItems, [`expense-${newExpense.id}`]: true });
            };

            const updateExpense = (id, field, value) => {
                const updated = currentData.expense.map(item =>
                    item.id === id ? { ...item, [field]: value } : item
                );
                db.collection('household').doc(activeMonth).update({ expense: updated });
            };

            const deleteExpense = (id) => {
                const updated = currentData.expense.filter(item => item.id !== id);
                db.collection('household').doc(activeMonth).update({ expense: updated });
            };

            const addIncome = () => {
                const today = new Date().toISOString().split('T')[0];
                const newIncome = {
                    id: Date.now(),
                    date: today,
                    content: '',
                    amount: ''
                };
                const updated = [...currentData.income, newIncome];
                db.collection('household').doc(activeMonth).update({ income: updated });
                setEditingItems({ ...editingItems, [`income-${newIncome.id}`]: true });
            };

            const updateIncome = (id, field, value) => {
                const updated = currentData.income.map(item =>
                    item.id === id ? { ...item, [field]: value } : item
                );
                db.collection('household').doc(activeMonth).update({ income: updated });
            };

            const deleteIncome = (id) => {
                const updated = currentData.income.filter(item => item.id !== id);
                db.collection('household').doc(activeMonth).update({ income: updated });
            };

            const toggleEdit = (type, id) => {
                const key = `${type}-${id}`;
                setEditingItems({ ...editingItems, [key]: !editingItems[key] });
            };

            const completeEdit = (type, id) => {
                const key = `${type}-${id}`;
                setEditingItems({ ...editingItems, [key]: false });
            };

            const fixedTotal = calculateTotal(currentData.fixed);
            const expenseTotal = calculateTotal(currentData.expense);
            const incomeTotal = calculateTotal(currentData.income);
            const balance = incomeTotal - fixedTotal - expenseTotal;

            if (isLoading) {
                return (
                    <div className="flex items-center justify-center h-screen bg-gray-50">
                        <div className="text-center">
                            <div className="text-4xl mb-4">üí∞</div>
                            <div className="text-xl font-bold text-gray-700">Î°úÎî© Ï§ë...</div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50 pb-20">
                    {/* Ìó§Îçî */}
                    <div className="sticky top-0 bg-gradient-to-r from-purple-600 to-blue-600 text-white shadow-lg z-20">
                        <div className="px-4 py-4">
                            <h1 className="text-2xl font-bold text-center mb-3">üí∞ Î∂ÄÎ∂Ä Í≥µÏú† Í∞ÄÍ≥ÑÎ∂Ä</h1>
                            
                            {/* Ïõî ÏÑ†ÌÉù Î≤ÑÌäº */}
                            <div className="flex gap-2 overflow-x-auto pb-2 scrollbar-hide">
                                {months.map(month => (
                                    <div key={month} className="flex-shrink-0 flex gap-1">
                                        {editingMonth === month ? (
                                            <div className="flex gap-1">
                                                <input
                                                    type="text"
                                                    value={editMonthValue}
                                                    onChange={(e) => setEditMonthValue(e.target.value)}
                                                    className="w-24 px-2 py-1 text-black rounded text-sm"
                                                    placeholder="25ÎÖÑ11Ïõî"
                                                />
                                                <button
                                                    onClick={saveEditMonth}
                                                    className="px-2 py-1 bg-green-500 rounded text-xs"
                                                >
                                                    Ï†ÄÏû•
                                                </button>
                                            </div>
                                        ) : (
                                            <>
                                                <button
                                                    onClick={() => setActiveMonth(month)}
                                                    className={`px-4 py-2 rounded-lg font-bold text-sm transition-all ${
                                                        activeMonth === month
                                                            ? 'bg-white text-purple-600 shadow-lg scale-105'
                                                            : 'bg-purple-700 hover:bg-purple-800'
                                                    }`}
                                                >
                                                    {month}
                                                </button>
                                                <button
                                                    onClick={() => startEditMonth(month)}
                                                    className="p-2 bg-yellow-500 rounded hover:bg-yellow-600"
                                                >
                                                    <Edit2 size={14} />
                                                </button>
                                                <button
                                                    onClick={() => deleteMonth(month)}
                                                    className="p-2 bg-red-500 rounded hover:bg-red-600"
                                                >
                                                    <X size={14} />
                                                </button>
                                            </>
                                        )}
                                    </div>
                                ))}
                                <button
                                    onClick={() => setShowAddMonth(!showAddMonth)}
                                    className="flex-shrink-0 w-10 h-10 flex items-center justify-center bg-green-500 rounded-lg hover:bg-green-600 transition-colors font-bold text-xl"
                                >
                                    +
                                </button>
                            </div>

                            {/* Ïõî Ï∂îÍ∞Ä Ìèº */}
                            {showAddMonth && (
                                <div className="mt-3 p-3 bg-white rounded-lg">
                                    <div className="flex gap-2 items-center">
                                        <input
                                            type="number"
                                            value={newMonthYear}
                                            onChange={(e) => setNewMonthYear(e.target.value)}
                                            placeholder="ÎÖÑ"
                                            className="w-16 px-2 py-2 border rounded text-black text-center"
                                        />
                                        <span className="text-black font-bold">ÎÖÑ</span>
                                        <input
                                            type="number"
                                            value={newMonthMonth}
                                            onChange={(e) => setNewMonthMonth(e.target.value.padStart(2, '0'))}
                                            placeholder="Ïõî"
                                            className="w-16 px-2 py-2 border rounded text-black text-center"
                                        />
                                        <span className="text-black font-bold">Ïõî</span>
                                        <button
                                            onClick={addMonth}
                                            className="flex-1 px-3 py-2 bg-blue-600 text-white rounded font-bold hover:bg-blue-700"
                                        >
                                            Ï∂îÍ∞Ä
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Î©îÏù∏ Ïª®ÌÖêÏ∏† */}
                    <div className="p-3">
                        {/* ÏöîÏïΩ Ïπ¥Îìú */}
                        <div className="grid grid-cols-3 gap-2 mb-3">
                            <div className="bg-gradient-to-br from-green-400 to-green-600 rounded-xl p-3 text-white shadow-lg">
                                <div className="text-xs font-bold mb-1">Ï¥ùÏû•Ï∞®Ïï°</div>
                                <div className="text-sm font-bold break-words leading-tight">{formatNumber(fixedTotal)}Ïõê</div>
                            </div>
                            <div className="bg-gradient-to-br from-red-400 to-red-600 rounded-xl p-3 text-white shadow-lg">
                                <div className="text-xs font-bold mb-1">ÏßÄÏ∂úÌï©Í≥Ñ</div>
                                <div className="text-sm font-bold break-words leading-tight">{formatNumber(expenseTotal)}Ïõê</div>
                            </div>
                            <div className="bg-gradient-to-br from-blue-400 to-blue-600 rounded-xl p-3 text-white shadow-lg">
                                <div className="text-xs font-bold mb-1">ÏàòÏûÖÌï©Í≥Ñ</div>
                                <div className="text-sm font-bold break-words leading-tight">{formatNumber(incomeTotal)}Ïõê</div>
                            </div>
                        </div>

                        {/* ÏûîÏï° Ïπ¥Îìú */}
                        <div className={`mb-3 p-4 rounded-xl shadow-lg ${balance >= 0 ? 'bg-gradient-to-br from-emerald-400 to-emerald-600' : 'bg-gradient-to-br from-orange-400 to-orange-600'} text-white`}>
                            <div className="flex justify-between items-center">
                                <span className="text-lg font-bold">üí∞ Ïù¥Îã¨Ïùò ÏûîÏï°</span>
                                <span className="text-2xl font-bold">{formatNumber(balance)}Ïõê</span>
                            </div>
                        </div>

                        {/* Í≥†Ï†ï ÏßÄÏ∂ú ÏÑπÏÖò */}
                        <div className="bg-white shadow-lg rounded-2xl mb-3 overflow-hidden">
                            <button
                                onClick={() => setIsFixedExpanded(!isFixedExpanded)}
                                className="w-full px-4 py-3 flex items-center justify-between bg-purple-600 text-white hover:bg-purple-700 transition-colors"
                            >
                                <span className="text-lg font-bold">üè† Í≥†Ï†ïÏßÄÏ∂ú</span>
                                {isFixedExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                            </button>

                            {isFixedExpanded && (
                                <div className="p-3">
                                    <div className="space-y-2">
                                        {currentData.fixed.length === 0 ? (
                                            <div className="text-center py-8 text-gray-400 text-sm">
                                                Í≥†Ï†ï ÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§
                                            </div>
                                        ) : (
                                            currentData.fixed.map(item => {
                                                const isEditing = editingItems[`fixed-${item.id}`];
                                                return (
                                                    <div key={item.id} className="bg-purple-50 p-2 rounded-lg border border-purple-200">
                                                        <div className="flex gap-1 items-center">
                                                            <input
                                                                type="date"
                                                                value={item.date || new Date().toISOString().split('T')[0]}
                                                                onChange={(e) => updateFixed(item.id, 'date', e.target.value)}
                                                                className="w-28 px-1 py-2 border rounded text-xs"
                                                                disabled={!isEditing}
                                                            />
                                                            <KoreanInput
                                                                type="text"
                                                                value={item.content}
                                                                onChange={(value) => updateFixed(item.id, 'content', value)}
                                                                placeholder="ÎÇ¥Ïö©"
                                                                className="flex-1 px-2 py-2 border rounded text-sm min-w-0"
                                                                disabled={!isEditing}
                                                            />
                                                            {isEditing ? (
                                                                <input
                                                                    type="number"
                                                                    value={item.amount || ''}
                                                                    onChange={(e) => updateFixed(item.id, 'amount', e.target.value)}
                                                                    placeholder="Í∏àÏï°"
                                                                    className="w-24 px-2 py-2 border rounded text-sm"
                                                                />
                                                            ) : (
                                                                <div className="w-24 px-2 py-2 border rounded bg-gray-100 text-xs font-bold text-right">
                                                                    {formatNumber(item.amount)}Ïõê
                                                                </div>
                                                            )}
                                                            <button
                                                                onClick={() => isEditing ? completeEdit('fixed', item.id) : toggleEdit('fixed', item.id)}
                                                                className={`px-3 py-2 rounded font-bold text-xs ${
                                                                    isEditing 
                                                                        ? 'bg-green-500 text-white' 
                                                                        : 'bg-blue-500 text-white'
                                                                }`}
                                                            >
                                                                {isEditing ? 'ÏôÑÎ£å' : 'ÏàòÏ†ï'}
                                                            </button>
                                                            <button
                                                                onClick={() => deleteFixed(item.id)}
                                                                className="p-2 text-red-500 hover:bg-red-50 rounded"
                                                            >
                                                                <Trash2 size={16} />
                                                            </button>
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        )}
                                    </div>
                                    <button
                                        onClick={addFixed}
                                        className="mt-3 w-full flex items-center justify-center gap-2 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 font-bold"
                                    >
                                        <Plus size={20} />
                                        Í≥†Ï†ïÏßÄÏ∂ú Ï∂îÍ∞Ä
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* ÏßÄÏ∂ú ÏÑπÏÖò */}
                        <div className="bg-white shadow-lg rounded-2xl mb-3 overflow-hidden">
                            <button
                                onClick={() => setIsExpenseExpanded(!isExpenseExpanded)}
                                className="w-full px-4 py-3 flex items-center justify-between bg-red-600 text-white hover:bg-red-700 transition-colors"
                            >
                                <span className="text-lg font-bold">üí∏ ÏßÄÏ∂ú</span>
                                {isExpenseExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                            </button>

                            {isExpenseExpanded && (
                                <div className="p-3">
                                    <div className="space-y-2">
                                        {currentData.expense.length === 0 ? (
                                            <div className="text-center py-8 text-gray-400 text-sm">
                                                ÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§
                                            </div>
                                        ) : (
                                            currentData.expense.map(item => {
                                                const isEditing = editingItems[`expense-${item.id}`];
                                                return (
                                                    <div key={item.id} className="bg-red-50 p-2 rounded-lg border border-red-200">
                                                        <div className="flex gap-1 items-center">
                                                            <input
                                                                type="date"
                                                                value={item.date}
                                                                onChange={(e) => updateExpense(item.id, 'date', e.target.value)}
                                                                className="w-28 px-1 py-2 border rounded text-xs"
                                                                disabled={!isEditing}
                                                            />
                                                            <KoreanInput
                                                                type="text"
                                                                value={item.content}
                                                                onChange={(value) => updateExpense(item.id, 'content', value)}
                                                                placeholder="ÎÇ¥Ïö©"
                                                                className="flex-1 px-2 py-2 border rounded text-sm min-w-0"
                                                                disabled={!isEditing}
                                                            />
                                                            {isEditing ? (
                                                                <input
                                                                    type="number"
                                                                    value={item.amount || ''}
                                                                    onChange={(e) => updateExpense(item.id, 'amount', e.target.value)}
                                                                    placeholder="Í∏àÏï°"
                                                                    className="w-24 px-2 py-2 border rounded text-sm"
                                                                />
                                                            ) : (
                                                                <div className="w-24 px-2 py-2 border rounded bg-gray-100 text-xs font-bold text-right">
                                                                    {formatNumber(item.amount)}Ïõê
                                                                </div>
                                                            )}
                                                            <button
                                                                onClick={() => isEditing ? completeEdit('expense', item.id) : toggleEdit('expense', item.id)}
                                                                className={`px-3 py-2 rounded font-bold text-xs ${
                                                                    isEditing 
                                                                        ? 'bg-green-500 text-white' 
                                                                        : 'bg-blue-500 text-white'
                                                                }`}
                                                            >
                                                                {isEditing ? 'ÏôÑÎ£å' : 'ÏàòÏ†ï'}
                                                            </button>
                                                            <button
                                                                onClick={() => deleteExpense(item.id)}
                                                                className="p-2 text-red-500 hover:bg-red-50 rounded"
                                                            >
                                                                <Trash2 size={16} />
                                                            </button>
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        )}
                                    </div>
                                    <button
                                        onClick={addExpense}
                                        className="mt-3 w-full flex items-center justify-center gap-2 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 font-bold"
                                    >
                                        <Plus size={20} />
                                        ÏßÄÏ∂ú Ï∂îÍ∞Ä
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* ÏàòÏûÖ ÏÑπÏÖò */}
                        <div className="bg-white shadow-lg rounded-2xl mb-3 overflow-hidden">
                            <button
                                onClick={() => setIsIncomeExpanded(!isIncomeExpanded)}
                                className="w-full px-4 py-3 flex items-center justify-between bg-blue-600 text-white hover:bg-blue-700 transition-colors"
                            >
                                <span className="text-lg font-bold">üíµ ÏàòÏûÖ</span>
                                {isIncomeExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                            </button>

                            {isIncomeExpanded && (
                                <div className="p-3">
                                    <div className="space-y-2">
                                        {currentData.income.length === 0 ? (
                                            <div className="text-center py-8 text-gray-400 text-sm">
                                                ÏàòÏûÖ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§
                                            </div>
                                        ) : (
                                            currentData.income.map(item => {
                                                const isEditing = editingItems[`income-${item.id}`];
                                                return (
                                                    <div key={item.id} className="bg-blue-50 p-2 rounded-lg border border-blue-200">
                                                        <div className="flex gap-1 items-center">
                                                            <input
                                                                type="date"
                                                                value={item.date}
                                                                onChange={(e) => updateIncome(item.id, 'date', e.target.value)}
                                                                className="w-28 px-1 py-2 border rounded text-xs"
                                                                disabled={!isEditing}
                                                            />
                                                            <KoreanInput
                                                                type="text"
                                                                value={item.content}
                                                                onChange={(value) => updateIncome(item.id, 'content', value)}
                                                                placeholder="ÎÇ¥Ïö©"
                                                                className="flex-1 px-2 py-2 border rounded text-sm min-w-0"
                                                                disabled={!isEditing}
                                                            />
                                                            {isEditing ? (
                                                                <input
                                                                    type="number"
                                                                    value={item.amount || ''}
                                                                    onChange={(e) => updateIncome(item.id, 'amount', e.target.value)}
                                                                    placeholder="Í∏àÏï°"
                                                                    className="w-24 px-2 py-2 border rounded text-sm"
                                                                />
                                                            ) : (
                                                                <div className="w-24 px-2 py-2 border rounded bg-gray-100 text-xs font-bold text-right">
                                                                    {formatNumber(item.amount)}Ïõê
                                                                </div>
                                                            )}
                                                            <button
                                                                onClick={() => isEditing ? completeEdit('income', item.id) : toggleEdit('income', item.id)}
                                                                className={`px-3 py-2 rounded font-bold text-xs ${
                                                                    isEditing 
                                                                        ? 'bg-green-500 text-white' 
                                                                        : 'bg-blue-500 text-white'
                                                                }`}
                                                            >
                                                                {isEditing ? 'ÏôÑÎ£å' : 'ÏàòÏ†ï'}
                                                            </button>
                                                            <button
                                                                onClick={() => deleteIncome(item.id)}
                                                                className="p-2 text-red-500 hover:bg-red-50 rounded"
                                                            >
                                                                <Trash2 size={16} />
                                                            </button>
                                                        </div>
                                                    </div>
                                                );
                                            })
                                        )}
                                    </div>
                                    <button
                                        onClick={addIncome}
                                        className="mt-3 w-full flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-bold"
                                    >
                                        <Plus size={20} />
                                        ÏàòÏûÖ Ï∂îÍ∞Ä
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Household />);
    </script>
</body>
</html>