<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ Î∂ÄÎ∂Ä Í≥µÏú† Í∞ÄÍ≥ÑÎ∂Ä</title>
    
    <!-- Firebase SDK (Firestore) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        .pulse-green {
            animation: pulse-green 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse-green {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ‚ö†Ô∏è Ïó¨Í∏∞Ïóê Firebase Íµ¨ÏÑ± Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî
        const firebaseConfig = {
            apiKey: "AIzaSyBiC54tZWk4qK3dRjlgEhTmWhLkLTF7JJU",
            authDomain: "dasol-moneybook-28576.firebaseapp.com",
            projectId: "dasol-moneybook-28576",
            storageBucket: "dasol-moneybook-28576.firebasestorage.app",
            messagingSenderId: "197049671466",
            appId: "1:197049671466:web:c382db717dfa195cdac853"
        };

        // Firebase Ï¥àÍ∏∞Ìôî
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // ÏïÑÏù¥ÏΩò Ïª¥Ìè¨ÎÑåÌä∏Îì§
        const ChevronDown = ({ size = 24 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            }, React.createElement('polyline', { points: "6 9 12 15 18 9" }))
        );

        const ChevronUp = ({ size = 24 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            }, React.createElement('polyline', { points: "18 15 12 9 6 15" }))
        );

        const Plus = ({ size = 24 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('line', { x1: "12", y1: "5", x2: "12", y2: "19" }),
                React.createElement('line', { x1: "5", y1: "12", x2: "19", y2: "12" })
            )
        );

        const Trash2 = ({ size = 24 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('polyline', { points: "3 6 5 6 21 6" }),
                React.createElement('path', { d: "M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" }),
                React.createElement('line', { x1: "10", y1: "11", x2: "10", y2: "17" }),
                React.createElement('line', { x1: "14", y1: "11", x2: "14", y2: "17" })
            )
        );

        const Wifi = ({ size = 24 }) => (
            React.createElement('svg', {
                width: size, height: size, viewBox: "0 0 24 24", fill: "none",
                stroke: "currentColor", strokeWidth: "2", strokeLinecap: "round", strokeLinejoin: "round"
            },
                React.createElement('path', { d: "M5 12.55a11 11 0 0 1 14.08 0" }),
                React.createElement('path', { d: "M1.42 9a16 16 0 0 1 21.16 0" }),
                React.createElement('path', { d: "M8.53 16.11a6 6 0 0 1 6.95 0" }),
                React.createElement('line', { x1: "12", y1: "20", x2: "12.01", y2: "20" })
            )
        );

        function Household() {
            const [activeMonth, setActiveMonth] = useState('25ÎÖÑ11Ïõî');
            const [monthData, setMonthData] = useState({});
            const [isFixedExpanded, setIsFixedExpanded] = useState(true);
            const [isExpenseExpanded, setIsExpenseExpanded] = useState(true);
            const [isIncomeExpanded, setIsIncomeExpanded] = useState(true);
            const [months, setMonths] = useState([]);
            const [showAddMonth, setShowAddMonth] = useState(false);
            const [newMonthYear, setNewMonthYear] = useState('25');
            const [newMonthMonth, setNewMonthMonth] = useState('01');
            const [editingItems, setEditingItems] = useState({});
            const [isLoading, setIsLoading] = useState(true);
            const [lastSync, setLastSync] = useState(new Date());
            const [isOnline, setIsOnline] = useState(true);

            // FirestoreÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Ïã§ÏãúÍ∞Ñ Î°úÎìú
            useEffect(() => {
                const unsubscribe = db.collection('household').onSnapshot((snapshot) => {
                    const data = {};
                    const monthsList = [];
                    
                    snapshot.forEach((doc) => {
                        const monthName = doc.id;
                        monthsList.push(monthName);
                        data[monthName] = doc.data();
                    });

                    if (monthsList.length === 0) {
                        // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ ÏÑ§Ï†ï
                        const initialMonths = ['25ÎÖÑ11Ïõî', '25ÎÖÑ12Ïõî', '26ÎÖÑ01Ïõî'];
                        initialMonths.forEach(month => {
                            db.collection('household').doc(month).set({
                                fixedExpenses: [],
                                income: [],
                                expenses: []
                            });
                        });
                    } else {
                        setMonths(monthsList.sort());
                        setMonthData(data);
                        if (!activeMonth || !monthsList.includes(activeMonth)) {
                            setActiveMonth(monthsList[0]);
                        }
                        setIsLoading(false);
                        setLastSync(new Date());
                    }
                }, (error) => {
                    console.error("Firestore ÏóêÎü¨:", error);
                    setIsOnline(false);
                });

                // Ïò®ÎùºÏù∏/Ïò§ÌîÑÎùºÏù∏ ÏÉÅÌÉú Í∞êÏßÄ
                const handleOnline = () => setIsOnline(true);
                const handleOffline = () => setIsOnline(false);
                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);

                return () => {
                    unsubscribe();
                    window.removeEventListener('online', handleOnline);
                    window.removeEventListener('offline', handleOffline);
                };
            }, []);

            const currentData = monthData[activeMonth] || { fixedExpenses: [], income: [], expenses: [] };

            // ÌòÑÏû¨ ÎÖÑÏõîÎßå Í∞ÄÏ†∏Ïò§Í∏∞
            const getCurrentYearMonth = () => {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                return `${year}-${month}-`;
            };

            // ÏàòÏ†ï Î™®Îìú ÌÜ†Í∏Ä
            const toggleEdit = (type, id) => {
                const key = `${type}-${id}`;
                setEditingItems({ ...editingItems, [key]: !editingItems[key] });
            };

            // Í∏àÏï° Ìè¨Îß∑ÌåÖ
            const formatNumber = (num) => {
                if (!num) return '';
                return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
            };

            // ÎÇ†ÏßúÏàú Ï†ïÎ†¨
            const sortByDate = (items) => {
                return [...items].sort((a, b) => new Date(a.date) - new Date(b.date));
            };

            // Í≥ÑÏÇ∞
            const totalIncome = currentData.income.reduce((sum, item) => sum + item.amount, 0);
            const totalExpenses = currentData.expenses.reduce((sum, item) => sum + item.amount, 0) + 
                                  currentData.fixedExpenses.reduce((sum, item) => sum + item.amount, 0);
            const balance = totalIncome - totalExpenses;

            // Ïõî Ï∂îÍ∞Ä
            const addMonth = async () => {
                const newMonth = `${newMonthYear}ÎÖÑ${newMonthMonth}Ïõî`;
                if (!months.includes(newMonth)) {
                    try {
                        await db.collection('household').doc(newMonth).set({
                            fixedExpenses: [],
                            income: [],
                            expenses: []
                        });
                        setShowAddMonth(false);
                    } catch (error) {
                        console.error("Ïõî Ï∂îÍ∞Ä ÏóêÎü¨:", error);
                        alert("Ïõî Ï∂îÍ∞Ä Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
                    }
                }
            };

            // Ïõî ÏÇ≠Ï†ú
            const deleteMonth = async (monthToDelete) => {
                if (months.length === 1) {
                    alert('ÏµúÏÜå 1Í∞úÏùò ÏõîÏùÄ ÌïÑÏöîÌï©ÎãàÎã§.');
                    return;
                }
                if (window.confirm(`${monthToDelete}ÏùÑ(Î•º) ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)) {
                    try {
                        await db.collection('household').doc(monthToDelete).delete();
                    } catch (error) {
                        console.error("Ïõî ÏÇ≠Ï†ú ÏóêÎü¨:", error);
                        alert("Ïõî ÏÇ≠Ï†ú Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
                    }
                }
            };

            // Í≥†Ï†ïÏßÄÏ∂ú Ï∂îÍ∞Ä
            const addFixedExpense = async () => {
                const newExpense = {
                    id: Date.now(),
                    date: getCurrentYearMonth(),
                    content: '',
                    amount: 0
                };
                try {
                    await db.collection('household').doc(activeMonth).update({
                        fixedExpenses: [...currentData.fixedExpenses, newExpense]
                    });
                    toggleEdit('fixed', newExpense.id);
                } catch (error) {
                    console.error("Í≥†Ï†ïÏßÄÏ∂ú Ï∂îÍ∞Ä ÏóêÎü¨:", error);
                }
            };

            // Í≥†Ï†ïÏßÄÏ∂ú ÏàòÏ†ï
            const updateFixedExpense = async (id, field, value) => {
                const updatedExpenses = currentData.fixedExpenses.map(item =>
                    item.id === id ? { ...item, [field]: field === 'amount' ? Number(value) : value } : item
                );
                try {
                    await db.collection('household').doc(activeMonth).update({
                        fixedExpenses: updatedExpenses
                    });
                } catch (error) {
                    console.error("Í≥†Ï†ïÏßÄÏ∂ú ÏàòÏ†ï ÏóêÎü¨:", error);
                }
            };

            // Í≥†Ï†ïÏßÄÏ∂ú ÏôÑÎ£å
            const completeFixedExpense = async (id) => {
                toggleEdit('fixed', id);
                try {
                    await db.collection('household').doc(activeMonth).update({
                        fixedExpenses: sortByDate(currentData.fixedExpenses)
                    });
                } catch (error) {
                    console.error("Í≥†Ï†ïÏßÄÏ∂ú ÏôÑÎ£å ÏóêÎü¨:", error);
                }
            };

            // Í≥†Ï†ïÏßÄÏ∂ú ÏÇ≠Ï†ú
            const deleteFixedExpense = async (id) => {
                try {
                    await db.collection('household').doc(activeMonth).update({
                        fixedExpenses: currentData.fixedExpenses.filter(item => item.id !== id)
                    });
                } catch (error) {
                    console.error("Í≥†Ï†ïÏßÄÏ∂ú ÏÇ≠Ï†ú ÏóêÎü¨:", error);
                }
            };

            // ÏàòÏûÖ Ï∂îÍ∞Ä
            const addIncome = async () => {
                const newIncome = {
                    id: Date.now(),
                    date: getCurrentYearMonth(),
                    content: '',
                    amount: 0
                };
                try {
                    await db.collection('household').doc(activeMonth).update({
                        income: [...currentData.income, newIncome]
                    });
                    toggleEdit('income', newIncome.id);
                } catch (error) {
                    console.error("ÏàòÏûÖ Ï∂îÍ∞Ä ÏóêÎü¨:", error);
                }
            };

            // ÏàòÏûÖ ÏàòÏ†ï
            const updateIncome = async (id, field, value) => {
                const updatedIncome = currentData.income.map(item =>
                    item.id === id ? { ...item, [field]: field === 'amount' ? Number(value) : value } : item
                );
                try {
                    await db.collection('household').doc(activeMonth).update({
                        income: updatedIncome
                    });
                } catch (error) {
                    console.error("ÏàòÏûÖ ÏàòÏ†ï ÏóêÎü¨:", error);
                }
            };

            // ÏàòÏûÖ ÏôÑÎ£å
            const completeIncome = async (id) => {
                toggleEdit('income', id);
                try {
                    await db.collection('household').doc(activeMonth).update({
                        income: sortByDate(currentData.income)
                    });
                } catch (error) {
                    console.error("ÏàòÏûÖ ÏôÑÎ£å ÏóêÎü¨:", error);
                }
            };

            // ÏàòÏûÖ ÏÇ≠Ï†ú
            const deleteIncome = async (id) => {
                try {
                    await db.collection('household').doc(activeMonth).update({
                        income: currentData.income.filter(item => item.id !== id)
                    });
                } catch (error) {
                    console.error("ÏàòÏûÖ ÏÇ≠Ï†ú ÏóêÎü¨:", error);
                }
            };

            // ÏßÄÏ∂ú Ï∂îÍ∞Ä
            const addExpense = async () => {
                const newExpense = {
                    id: Date.now(),
                    date: getCurrentYearMonth(),
                    content: '',
                    amount: 0
                };
                try {
                    await db.collection('household').doc(activeMonth).update({
                        expenses: [...currentData.expenses, newExpense]
                    });
                    toggleEdit('expense', newExpense.id);
                } catch (error) {
                    console.error("ÏßÄÏ∂ú Ï∂îÍ∞Ä ÏóêÎü¨:", error);
                }
            };

            // ÏßÄÏ∂ú ÏàòÏ†ï
            const updateExpense = async (id, field, value) => {
                const updatedExpenses = currentData.expenses.map(item =>
                    item.id === id ? { ...item, [field]: field === 'amount' ? Number(value) : value } : item
                );
                try {
                    await db.collection('household').doc(activeMonth).update({
                        expenses: updatedExpenses
                    });
                } catch (error) {
                    console.error("ÏßÄÏ∂ú ÏàòÏ†ï ÏóêÎü¨:", error);
                }
            };

            // ÏßÄÏ∂ú ÏôÑÎ£å
            const completeExpense = async (id) => {
                toggleEdit('expense', id);
                try {
                    await db.collection('household').doc(activeMonth).update({
                        expenses: sortByDate(currentData.expenses)
                    });
                } catch (error) {
                    console.error("ÏßÄÏ∂ú ÏôÑÎ£å ÏóêÎü¨:", error);
                }
            };

            // ÏßÄÏ∂ú ÏÇ≠Ï†ú
            const deleteExpense = async (id) => {
                try {
                    await db.collection('household').doc(activeMonth).update({
                        expenses: currentData.expenses.filter(item => item.id !== id)
                    });
                } catch (error) {
                    console.error("ÏßÄÏ∂ú ÏÇ≠Ï†ú ÏóêÎü¨:", error);
                }
            };

            if (isLoading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 flex items-center justify-center">
                        <div className="text-center">
                            <div className="inline-block animate-spin rounded-full h-16 w-16 border-4 border-indigo-600 border-t-transparent mb-4"></div>
                            <p className="text-gray-600 text-lg">Îç∞Ïù¥ÌÑ∞ Î°úÎî©Ï§ë...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-4">
                    <div className="max-w-4xl mx-auto">
                        {/* Ìó§Îçî */}
                        <div className="bg-white rounded-t-2xl shadow-lg p-6">
                            <div className="flex justify-between items-center mb-6">
                                <h1 className="text-3xl font-bold text-gray-800">üí∞ Î∂ÄÎ∂Ä Í≥µÏú† Í∞ÄÍ≥ÑÎ∂Ä</h1>
                                <div className="flex items-center gap-3">
                                    <div className={`flex items-center gap-2 px-3 py-1 rounded-full ${isOnline ? 'bg-green-100' : 'bg-red-100'}`}>
                                        <Wifi size={16} className={isOnline ? 'text-green-600' : 'text-red-600'} />
                                        <span className={`text-sm font-semibold ${isOnline ? 'text-green-600' : 'text-red-600'}`}>
                                            {isOnline ? 'Ïò®ÎùºÏù∏' : 'Ïò§ÌîÑÎùºÏù∏'}
                                        </span>
                                    </div>
                                    <div className="text-sm text-gray-500">
                                        <div className={isOnline ? 'pulse-green' : ''}>
                                            {lastSync.toLocaleTimeString('ko-KR')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            {/* ÏõîÎ≥Ñ ÌÉ≠ */}
                            <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
                                {months.map(month => (
                                    <div key={month} className="relative">
                                        <button
                                            onClick={() => setActiveMonth(month)}
                                            className={`px-6 py-3 rounded-lg font-semibold transition-all whitespace-nowrap ${
                                                activeMonth === month
                                                    ? 'bg-indigo-600 text-white shadow-md'
                                                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                            }`}
                                        >
                                            {month}
                                        </button>
                                        {months.length > 1 && (
                                            <button
                                                onClick={(e) => {
                                                    e.stopPropagation();
                                                    deleteMonth(month);
                                                }}
                                                className="absolute -top-2 -right-2 w-6 h-6 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors flex items-center justify-center text-xs font-bold shadow-md"
                                            >
                                                ‚úï
                                            </button>
                                        )}
                                    </div>
                                ))}
                                <button
                                    onClick={() => setShowAddMonth(!showAddMonth)}
                                    className="px-6 py-3 rounded-lg font-semibold bg-green-500 text-white hover:bg-green-600 transition-all whitespace-nowrap flex items-center gap-2"
                                >
                                    <Plus size={20} />
                                    Ïõî Ï∂îÍ∞Ä
                                </button>
                            </div>

                            {/* Ïõî Ï∂îÍ∞Ä Ìèº */}
                            {showAddMonth && (
                                <div className="mb-6 p-4 bg-gray-50 rounded-lg">
                                    <div className="flex gap-2 items-center">
                                        <input
                                            type="text"
                                            value={newMonthYear}
                                            onChange={(e) => setNewMonthYear(e.target.value)}
                                            placeholder="ÎÖÑÎèÑ (Ïòà: 25)"
                                            className="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                            maxLength="2"
                                        />
                                        <span className="font-semibold">ÎÖÑ</span>
                                        <input
                                            type="text"
                                            value={newMonthMonth}
                                            onChange={(e) => setNewMonthMonth(e.target.value)}
                                            placeholder="Ïõî (Ïòà: 01)"
                                            className="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                            maxLength="2"
                                        />
                                        <span className="font-semibold">Ïõî</span>
                                        <button
                                            onClick={addMonth}
                                            className="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold"
                                        >
                                            Ï∂îÍ∞Ä
                                        </button>
                                        <button
                                            onClick={() => setShowAddMonth(false)}
                                            className="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors font-semibold"
                                        >
                                            Ï∑®ÏÜå
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* ÏöîÏïΩ Ï†ïÎ≥¥ */}
                            <div className="grid grid-cols-3 gap-4 mb-6">
                                <div className="bg-gradient-to-br from-green-50 to-green-100 p-4 rounded-xl border-2 border-green-200">
                                    <div className="text-sm text-green-700 font-semibold mb-1">ÌÜµÏû•ÏûîÏï°</div>
                                    <div className="text-2xl font-bold text-green-600">
                                        {Math.abs(balance).toLocaleString()}Ïõê
                                    </div>
                                </div>
                                <div className="bg-gradient-to-br from-red-50 to-red-100 p-4 rounded-xl border-2 border-red-200">
                                    <div className="text-sm text-red-700 font-semibold mb-1">ÏßÄÏ∂úÌï©Í≥Ñ</div>
                                    <div className="text-2xl font-bold text-red-600">
                                        {Math.abs(totalExpenses).toLocaleString()}Ïõê
                                    </div>
                                </div>
                                <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-xl border-2 border-blue-200">
                                    <div className="text-sm text-blue-700 font-semibold mb-1">ÏàòÏûÖÌï©Í≥Ñ</div>
                                    <div className="text-2xl font-bold text-blue-600">
                                        {Math.abs(totalIncome).toLocaleString()}Ïõê
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Í≥†Ï†ïÏßÄÏ∂ú ÏÑπÏÖò */}
                        <div className="bg-white shadow-lg">
                            <div className="sticky top-0 bg-indigo-600 z-10">
                                <button
                                    onClick={() => setIsFixedExpanded(!isFixedExpanded)}
                                    className="w-full px-6 py-4 flex items-center justify-between text-white hover:bg-indigo-700 transition-colors"
                                >
                                    <span className="text-xl font-bold">Í≥†Ï†ïÏßÄÏ∂ú</span>
                                    {isFixedExpanded ? <ChevronUp size={24} /> : <ChevronDown size={24} />}
                                </button>
                            </div>

                            {isFixedExpanded && (
                                <div className="p-6">
                                    <div className="space-y-3">
                                        {currentData.fixedExpenses.length === 0 ? (
                                            <div className="text-center py-8 text-gray-400">
                                                Í≥†Ï†ïÏßÄÏ∂ú Ìï≠Î™©Ïù¥ ÏóÜÏäµÎãàÎã§
                                            </div>
                                        ) : (
                                            currentData.fixedExpenses.map(expense => {
                                                const isEditing = editingItems[`fixed-${expense.id}`];
                                                return (
                                                    <div key={expense.id} className="flex gap-3 items-center bg-gray-50 p-3 rounded-lg">
                                                        <input
                                                            type="date"
                                                            value={expense.date}
                                                            onChange={(e) => updateFixedExpense(expense.id, 'date', e.target.value)}
                                                            className="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                            disabled={!isEditing}
                                                        />
                                                        <input
                                                            type="text"
                                                            value={expense.content}
                                                            onChange={(e) => updateFixedExpense(expense.id, 'content', e.target.value)}
                                                            placeholder="ÎÇ¥Ïö©"
                                                            className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                            disabled={!isEditing}
                                                        />
                                                        {isEditing ? (
                                                            <input
                                                                type="number"
                                                                value={expense.amount || ''}
                                                                onChange={(e) => updateFixedExpense(expense.id, 'amount', e.target.value)}
                                                                placeholder="Í∏àÏï°"
                                                                className="w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                                            />
                                                        ) : (
                                                            <div className="w-32 px-3 py-2 border border-gray-300 rounded-lg bg-gray-100">
                                                                {formatNumber(expense.amount)}Ïõê
                                                            </div>
                                                        )}
                                                        <button
                                                            onClick={() => isEditing ? completeFixedExpense(expense.id) : toggleEdit('fixed', expense.id)}
                                                            className={`p-2 px-4 rounded-lg transition-colors font-semibold ${
                                                                isEditing 
                                                                    ? 'bg-green-500 text-white hover:bg-green-600' 
                                                                    : 'bg-blue-500 text-white hover:bg-blue-600'
                                                            }`}
                                                        >
                                                            {isEditing ? 'ÏôÑÎ£å' : 'ÏàòÏ†ï'}
                                                        </button>
                                                        <button
                                                            onClick={() => deleteFixedExpense(expense.id)}
                                                            className="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                                                        >
                                                            <Trash2 size={20} />
                                                        </button>
                                                    </div>
                                                );
                                            })
                                        )}
                                    </div>
                                    
                                    <button
                                        onClick={addFixedExpense}
                                        className="mt-4 w-full flex items-center justify-center gap-2 px-4 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold"
                                    >
                                        <Plus size={20} />
                                        Í≥†Ï†ïÏßÄÏ∂ú Ï∂îÍ∞Ä
                                    </button>
                                </div>
                            )}
                        </div>

                        <div className="bg-white rounded-b-2xl shadow-lg h-4"></div>

                        {/* ÏßÄÏ∂ú ÏÑπÏÖò */}
                        <div className="bg-white shadow-lg mt-4 rounded-2xl">
                            <div className="sticky top-0 bg-red-600 z-10 rounded-t-2xl">
                                <button
                                    onClick={() => setIsExpenseExpanded(!isExpenseExpanded)}
                                    className="w-full px-6 py-4 flex items-center justify-between text-white hover:bg-red-700 transition-colors rounded-t-2xl"
                                >
                                    <span className="text-xl font-bold">üí∏ ÏßÄÏ∂ú</span>
                                    {isExpenseExpanded ? <ChevronUp size={24} /> : <ChevronDown size={24} />}
                                </button>
                            </div>

                            {isExpenseExpanded && (
                                <div className="p-6">
                                    <div className="space-y-3">
                                        {currentData.expenses.length === 0 ? (
                                            <div className="text-center py-6 text-gray-400">
                                                ÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§
                                            </div>
                                        ) : (
                                            currentData.expenses.map(item => {
                                                const isEditing = editingItems[`expense-${item.id}`];
                                                return (
                                                    <div key={item.id} className="flex gap-3 items-center bg-red-50 p-3 rounded-lg border border-red-200">
                                                        <input
                                                            type="date"
                                                            value={item.date}
                                                            onChange={(e) => updateExpense(item.id, 'date', e.target.value)}
                                                            className="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
                                                            disabled={!isEditing}
                                                        />
                                                        <input
                                                            type="text"
                                                            value={item.content}
                                                            onChange={(e) => updateExpense(item.id, 'content', e.target.value)}
                                                            placeholder="ÎÇ¥Ïö©"
                                                            className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
                                                            disabled={!isEditing}
                                                        />
                                                        {isEditing ? (
                                                            <input
                                                                type="number"
                                                                value={item.amount || ''}
                                                                onChange={(e) => updateExpense(item.id, 'amount', e.target.value)}
                                                                placeholder="Í∏àÏï°"
                                                                className="w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
                                                            />
                                                        ) : (
                                                            <div className="w-32 px-3 py-2 border border-gray-300 rounded-lg bg-gray-100">
                                                                {formatNumber(item.amount)}Ïõê
                                                            </div>
                                                        )}
                                                        <button
                                                            onClick={() => isEditing ? completeExpense(item.id) : toggleEdit('expense', item.id)}
                                                            className={`p-2 px-4 rounded-lg transition-colors font-semibold ${
                                                                isEditing 
                                                                    ? 'bg-green-500 text-white hover:bg-green-600' 
                                                                    : 'bg-blue-500 text-white hover:bg-blue-600'
                                                            }`}
                                                        >
                                                            {isEditing ? 'ÏôÑÎ£å' : 'ÏàòÏ†ï'}
                                                        </button>
                                                        <button
                                                            onClick={() => deleteExpense(item.id)}
                                                            className="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                                                        >
                                                            <Trash2 size={20} />
                                                        </button>
                                                    </div>
                                                );
                                            })
                                        )}
                                    </div>
                                    <button
                                        onClick={addExpense}
                                        className="mt-4 w-full flex items-center justify-center gap-2 px-4 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold"
                                    >
                                        <Plus size={20} />
                                        ÏßÄÏ∂ú Ï∂îÍ∞Ä
                                    </button>
                                </div>
                            )}
                        </div>

                        {/* ÏàòÏûÖ ÏÑπÏÖò */}
                        <div className="bg-white shadow-lg mt-4 rounded-2xl mb-8">
                            <div className="sticky top-0 bg-blue-600 z-10 rounded-t-2xl">
                                <button
                                    onClick={() => setIsIncomeExpanded(!isIncomeExpanded)}
                                    className="w-full px-6 py-4 flex items-center justify-between text-white hover:bg-blue-700 transition-colors rounded-t-2xl"
                                >
                                    <span className="text-xl font-bold">üíµ ÏàòÏûÖ</span>
                                    {isIncomeExpanded ? <ChevronUp size={24} /> : <ChevronDown size={24} />}
                                </button>
                            </div>

                            {isIncomeExpanded && (
                                <div className="p-6">
                                    <div className="space-y-3">
                                        {currentData.income.length === 0 ? (
                                            <div className="text-center py-6 text-gray-400">
                                                ÏàòÏûÖ ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§
                                            </div>
                                        ) : (
                                            currentData.income.map(item => {
                                                const isEditing = editingItems[`income-${item.id}`];
                                                return (
                                                    <div key={item.id} className="flex gap-3 items-center bg-blue-50 p-3 rounded-lg border border-blue-200">
                                                        <input
                                                            type="date"
                                                            value={item.date}
                                                            onChange={(e) => updateIncome(item.id, 'date', e.target.value)}
                                                            className="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                            disabled={!isEditing}
                                                        />
                                                        <input
                                                            type="text"
                                                            value={item.content}
                                                            onChange={(e) => updateIncome(item.id, 'content', e.target.value)}
                                                            placeholder="ÎÇ¥Ïö©"
                                                            className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                            disabled={!isEditing}
                                                        />
                                                        {isEditing ? (
                                                            <input
                                                                type="number"
                                                                value={item.amount || ''}
                                                                onChange={(e) => updateIncome(item.id, 'amount', e.target.value)}
                                                                placeholder="Í∏àÏï°"
                                                                className="w-32 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                                            />
                                                        ) : (
                                                            <div className="w-32 px-3 py-2 border border-gray-300 rounded-lg bg-gray-100">
                                                                {formatNumber(item.amount)}Ïõê
                                                            </div>
                                                        )}
                                                        <button
                                                            onClick={() => isEditing ? completeIncome(item.id) : toggleEdit('income', item.id)}
                                                            className={`p-2 px-4 rounded-lg transition-colors font-semibold ${
                                                                isEditing 
                                                                    ? 'bg-green-500 text-white hover:bg-green-600' 
                                                                    : 'bg-blue-500 text-white hover:bg-blue-600'
                                                            }`}
                                                        >
                                                            {isEditing ? 'ÏôÑÎ£å' : 'ÏàòÏ†ï'}
                                                        </button>
                                                        <button
                                                            onClick={() => deleteIncome(item.id)}
                                                            className="p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                                                        >
                                                            <Trash2 size={20} />
                                                        </button>
                                                    </div>
                                                );
                                            })
                                        )}
                                    </div>
                                    <button
                                        onClick={addIncome}
                                        className="mt-4 w-full flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold"
                                    >
                                        <Plus size={20} />
                                        ÏàòÏûÖ Ï∂îÍ∞Ä
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Household />);
    </script>
</body>
</html>